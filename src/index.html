<!DOCTYPE html>
<html>
    <head>
        <meta charset="UTF-8">
        <title>Title of the document</title>
        <script src="https://unpkg.com/xlsx/dist/xlsx.full.min.js"></script>
        <script>
            function drawTable(xlJson, columnNames){
                var table = document.createElement("table");
            var tr = table.insertRow(-1);
            for (var i = 0; i < columnNames.length; i++) {
                var th = document.createElement("th");      // TABLE HEADER.
                th.innerHTML = columnNames[i];
                tr.appendChild(th);
            }
            for (var i = 0; i < xlJson.length; i++) {

                tr = table.insertRow(-1);

                for (var j = 0; j < columnNames.length; j++) {
                    var tabCell = tr.insertCell(-1);
                    tabCell.innerHTML = xlJson[i][columnNames[j]];
                }
            }
            var divContainer = document.getElementById("table");
            divContainer.innerHTML = "";
            divContainer.appendChild(table);

            }
            /* set up XMLHttpRequest */
            var url = "../bin/spreadsheet1.xlsx";
            var oReq = new XMLHttpRequest();
            oReq.open("GET", url, true);
            oReq.responseType = "arraybuffer";

            oReq.onload = function(e) {
            var arraybuffer = oReq.response;

            /* convert data to binary string */
            var data = new Uint8Array(arraybuffer);
            var arr = new Array();
            for(var i = 0; i != data.length; ++i) arr[i] = String.fromCharCode(data[i]);
            var bstr = arr.join("");

            /* Call XLSX */
            var workbook = XLSX.read(bstr, {type:"binary"});

            /* DO SOMETHING WITH workbook HERE */
            var first_sheet_name = workbook.SheetNames[0];
            var address_of_cell = 'A1';

            /* Get worksheet */
            var worksheet = workbook.Sheets[first_sheet_name];
            console.log(worksheet);
            let xlJson=[], columnNames=[];

            var keys = Object.keys(worksheet);
            keys.forEach(element => {
                
                if (element.charAt(1)==="1"){
                    columnNames.push(worksheet[element].v);
                }
            
            });
            
            let arrAlpha=['A','B','C','D','E','F','G','H','I'];
            for(let i=3;i<=9;i++){
                let rowObj={};
                for(let j=0;j< arrAlpha.length;j++){
                    
                    rowObj[columnNames[j]]=worksheet[arrAlpha[j]+i].v;

                }
                xlJson.push(rowObj);
            }
            console.log(xlJson);
            drawTable(xlJson , columnNames);            
            /*
            {
                cn[0]: worksheet[i,1],
                cn[1]: worksheet[i,2],
                cn[2]: worksheet[i,3],
                
            }
            }
            */
        }
        function eventInputText(){
             var edValue = document.getElementById("edValue");
             var s = edValue.value;
             var lblValue = document.getElementById("lblValue");
             console.log(this.xlJson);
             var filteredArr=this.xlJson.filter(function(i) {
             return i.name.contains(lblValue);
             });
               
            }
            
            
            
            oReq.send();    
        </script>
    </head>

    <body>
        <label for="text">Search (by ISP name, price, rating)</label>
        <input id= "edValue" type="text" onkeypress= "eventInputText()"><br>
        <span id="lblValue">The text box contains: </span>
        <p id="table"></p>
        <button type="button">Sort By</button>
        <input type="radio" name="sortby" value="Price"> Price
        <input type="radio" name="sortby" value="Rating"> Rating
    </body>

</html>
<!-- tr table row, th table header,  -->